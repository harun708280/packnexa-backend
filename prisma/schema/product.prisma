model Product {
  id                String           @id @default(uuid())
  merchantDetailsId String
  productName       String
  productCode       String?          @unique
  category          String
  status            ProductStatus    @default(PROCESSING)
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  description       String?
  rejectionReason   String?
  productImages     ProductImage[]
  warehouseLogs     WarehouseLog[]
  variants          ProductVariant[]
  merchantDetails   MerchantDetails  @relation(fields: [merchantDetailsId], references: [id])

  @@index([merchantDetailsId])
  @@index([createdAt])
  @@map("products")
}

model ProductImage {
  id        String   @id @default(uuid())
  productId String
  imageUrl  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
}

model ProductVariant {
  id                    String                 @id @default(uuid())
  productId             String
  variantName           String
  variantImage          String?
  sku                   String                 @unique
  unit                  String
  weightKg              Float?
  gen                   VariantGeneration      @default(AUTO)
  pickStrategy          PickStrategy           @default(FIFO)
  warehouseId           String
  supplier              String?
  quantity              Int                    @default(0)
  reservedQuantity      Int                    @default(0)
  soldQuantity          Int                    @default(0)
  returnedQuantity      Int                    @default(0)
  damagedQuantity       Int                    @default(0)
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  invoiceId             String?
  color                 String?
  size                  String?
  merchantDetailsId     String
  merchantWebProductId  String?                @unique
  batch                 Batch?
  inventoryTransactions InventoryTransaction[]
  stockControl          StockControl?
  location              VariantLocation?
  pricing               VariantPricing?
  orderItems            OrderItem[]
  product               Product                @relation(fields: [productId], references: [id], onDelete: Cascade)
  warehouse             Warehouse              @relation(fields: [warehouseId], references: [id])

  @@map("product_variants")
}

model VariantPricing {
  id            String         @id @default(uuid())
  variantId     String         @unique
  purchasePrice Float
  salePrice     Float
  variant       ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)
}

model Warehouse {
  id        String           @id @default(uuid())
  name      String
  location  String?
  createdAt DateTime         @default(now())
  variants  ProductVariant[]
}

model VariantLocation {
  id        String         @id @default(uuid())
  variantId String         @unique
  zone      String?
  rack      String?
  shelf     String?
  bin       String?
  side      String?
  variant   ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)
}

model StockControl {
  id           String         @id @default(uuid())
  variantId    String         @unique
  minStock     Int?
  reorderPoint Int?
  maxStock     Int?
  variant      ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)
}

model Batch {
  id           String         @id @default(uuid())
  variantId    String         @unique
  batchCode    String
  receivedDate DateTime?
  variant      ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)
}

model Supplier {
  id        String   @id @default(uuid())
  name      String
  contact   String?
  createdAt DateTime @default(now())
}

model InventoryTransaction {
  id        String         @id @default(uuid())
  variantId String
  type      InventoryType
  quantity  Int
  note      String?
  invoiceId String?
  createdAt DateTime       @default(now())
  variant   ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)
}

model WarehouseLog {
  id        String   @id @default(uuid())
  productId String
  action    String
  quantity  Int
  location  String?
  createdAt DateTime @default(now())
  product   Product  @relation(fields: [productId], references: [id])
}
