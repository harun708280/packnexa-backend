model Product {
  id                String        @id @default(uuid())
  merchantDetailsId String
  productName       String
  productCode       String?       @unique
  category          String
  status            ProductStatus @default(ACTIVE)

  merchantDetails MerchantDetails  @relation(fields: [merchantDetailsId], references: [id])
  variants        ProductVariant[]
  productImages   ProductImage[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("products")
}

model ProductImage {
  id        String @id @default(uuid())
  productId String
  imageUrl  String

  product Product @relation(fields: [productId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ProductVariant {
  id           String            @id @default(uuid())
  productId    String
  variantName  String
  variantImage String?
  sku          String            @unique
  unit         String
  weightKg     Float?
  gen          VariantGeneration @default(AUTO)
  pickStrategy PickStrategy      @default(FIFO)

  warehouseId String
  supplierId  String?

  quantity         Int @default(0)
  reservedQuantity Int @default(0)
  soldQuantity     Int @default(0)
  returnedQuantity Int @default(0)
  damagedQuantity  Int @default(0)

  product   Product   @relation(fields: [productId], references: [id])
  warehouse Warehouse @relation(fields: [warehouseId], references: [id])
  supplier  Supplier? @relation(fields: [supplierId], references: [id])

  pricing      VariantPricing?
  location     VariantLocation?
  stockControl StockControl?
  batch        Batch?

  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  inventoryTransactions InventoryTransaction[]

  @@map("product_variants")
}

model VariantPricing {
  id            String @id @default(uuid())
  variantId     String @unique
  purchasePrice Float
  salePrice     Float

  variant ProductVariant @relation(fields: [variantId], references: [id])
}

model Warehouse {
  id       String  @id @default(uuid())
  name     String
  location String?

  variants ProductVariant[]

  createdAt DateTime @default(now())
}

model VariantLocation {
  id        String @id @default(uuid())
  variantId String @unique

  zone  String?
  rack  String?
  shelf String?
  bin   String?
  side  String?

  variant ProductVariant @relation(fields: [variantId], references: [id])
}

model StockControl {
  id        String @id @default(uuid())
  variantId String @unique

  minStock     Int?
  reorderPoint Int?
  maxStock     Int?

  variant ProductVariant @relation(fields: [variantId], references: [id])
}

model Batch {
  id           String    @id @default(uuid())
  variantId    String    @unique
  batchCode    String
  receivedDate DateTime?

  variant ProductVariant @relation(fields: [variantId], references: [id])
}

model Supplier {
  id      String  @id @default(uuid())
  name    String
  contact String?

  variants ProductVariant[]

  createdAt DateTime @default(now())
}

model InventoryTransaction {
  id        String        @id @default(uuid())
  variantId String
  type      InventoryType
  quantity  Int
  note      String?
  invoiceId String?
  createdAt DateTime      @default(now())

  variant ProductVariant @relation(fields: [variantId], references: [id])
}
