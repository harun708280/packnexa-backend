model Product {
  id                   String        @id @default(uuid())
  merchantDetailsId    String
  productName          String
  description          String?
  merchantWebProductId String?
  productCode          String?       @unique
  category             String
  status               ProductStatus @default(PROCESSING)
  rejectionReason      String?

  merchantDetails MerchantDetails  @relation(fields: [merchantDetailsId], references: [id])
  variants        ProductVariant[]
  productImages   ProductImage[]
  warehouseLogs   WarehouseLog[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([merchantDetailsId])
  @@index([createdAt])
  @@map("products")
}

model ProductImage {
  id        String @id @default(uuid())
  productId String
  imageUrl  String

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ProductVariant {
  id           String            @id @default(uuid())
  productId    String
  variantName  String
  variantImage String?
  sku          String            @unique
  unit         String
  weightKg     Float?
  gen          VariantGeneration @default(AUTO)
  pickStrategy PickStrategy      @default(FIFO)

  warehouseId String
  supplier    String?
  invoiceId   String?
  color       String?
  size        String?

  quantity         Int @default(0)
  reservedQuantity Int @default(0)
  soldQuantity     Int @default(0)
  returnedQuantity Int @default(0)
  damagedQuantity  Int @default(0)

  product   Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  warehouse Warehouse @relation(fields: [warehouseId], references: [id])

  pricing      VariantPricing?
  location     VariantLocation?
  stockControl StockControl?
  batch        Batch?

  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  inventoryTransactions InventoryTransaction[]
  orderItems            OrderItem[]

  @@map("product_variants")
}

model VariantPricing {
  id            String @id @default(uuid())
  variantId     String @unique
  purchasePrice Float
  salePrice     Float

  variant ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)
}

model Warehouse {
  id       String           @id @default(uuid())
  name     String
  location String?
  variants ProductVariant[]

  createdAt DateTime @default(now())
}

model VariantLocation {
  id        String @id @default(uuid())
  variantId String @unique

  zone  String?
  rack  String?
  shelf String?
  bin   String?
  side  String?

  variant ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)
}

model StockControl {
  id        String @id @default(uuid())
  variantId String @unique

  minStock     Int?
  reorderPoint Int?
  maxStock     Int?

  variant ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)
}

model Batch {
  id           String    @id @default(uuid())
  variantId    String    @unique
  batchCode    String
  receivedDate DateTime?

  variant ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)
}

model Supplier {
  id      String  @id @default(uuid())
  name    String
  contact String?

  createdAt DateTime @default(now())
}

model InventoryTransaction {
  id        String        @id @default(uuid())
  variantId String
  type      InventoryType
  quantity  Int
  note      String?
  invoiceId String?
  createdAt DateTime      @default(now())

  variant ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)
}

model WarehouseLog {
  id        String   @id @default(uuid())
  productId String
  action    String
  quantity  Int
  location  String?
  createdAt DateTime @default(now())

  product Product @relation(fields: [productId], references: [id])
}
